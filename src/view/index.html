<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title></title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"
    />
    <link
      href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.7/dist/css/bootstrap-select.min.css"
    />
    <link rel="stylesheet" href="../css/template/common.css" />

    <script src="../js/jquery-3.4.1.min.js"></script>
    <script src="../js/panzoom.min.js"></script>

    <script src="../js/bootstrap.min.js"></script>
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.7/dist/js/bootstrap-select.min.js"></script>

    <script src="../js/svg.js"></script>
    <script src="../js/svg.filter.js"></script>

    <script src="../js/lodash.min.js"></script>

    <script src="../../out/defaultMap.js"></script>
    <script src="../js/drawSvg/drawSvg.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.1.0/anime.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/vivus/0.4.5/vivus.min.js"></script> -->
  </head>

  <body>
    <!-- 메인 -->
    <!-- FIXME: 버튼 구조 수정 많이 필요  -->
    <div class="jumbotron text-center jumbotron_line">
      <div id="zoom" class="zoom_box">
        <button id="zoomIn" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon glyphicon-zoom-in"></span> 확대
        </button>
        <button id="zoomOut" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon glyphicon-zoom-out"></span> 축소
        </button>
        <button id="reset" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon glyphicon-refresh"></span> 초기화
        </button>
        <div class="mr_1rem">
          <input id="placeNodeChangeNameToogleBtn" type="checkbox" data-toggle="toggle" />
        </div>
        <select class="selectpicker mr_1rem">
          <option value="view" selected>뷰 모드</option>
          <option value="control">제어 모드</option>
          <option value="develop">개발 모드</option>
        </select>
        <button id="rainMode" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon"></span> 우천모드
        </button>
      </div>
      <div>
        <div id="canvas" style="justify-content:center;"></div>
      </div>
    </div>

    <script>
      // 실제 사용할 때는 해당 부분 수정
      map.drawInfo.frame.mapInfo.backgroundInfo.backgroundData = '../../out/defaultMap.png';
      // 멥 그리기
      drawSvgBasePlace('canvas');

      //모드 선택 설렉트 박스 and 한/영 토글 버튼
      $('select, #placeNodeChangeNameToogleBtn').change(() => {
        const selectedModeVal = $('select').selectpicker('val');
        const isChecked = $('#placeNodeChangeNameToogleBtn').prop('checked'); // 체크 상태 false: off, true: on

        $(`#canvas`).empty(); // svg가 그려진 공간 초기화

        drawSvgBasePlace('canvas', isChecked); // 초기화 후 다시 그리기 (체크 상태 포함)

        bindingClickEventNode('', selectedModeVal); // 장치, 센서 클릭 이벤트 다시 바인딩
      });
    </script>
    <!-- set panzoom -->
    <script>
      var canvas = document.getElementById('canvas');
      var canvasPanzoom = Panzoom(canvas, {
        cursor: 'default',
      });

      $('#zoomIn').on('click', canvasPanzoom.zoomIn);
      $('#zoomOut').on('click', canvasPanzoom.zoomOut);
      $('#reset').on('click', canvasPanzoom.reset);
      canvas.addEventListener('wheel', canvasPanzoom.zoomWithWheel);
    </script>
    <!-- FIXME: map 그릴 때 좌표 찾기 용 -->
    <script>
      $('#svgCanvas').click(function(e) {
        var x = e.pageX;
        var y = e.pageY;

        console.log(x + ', ' + y);
      });
    </script>

    <!-- TODO: 애니메이션 테스트 -->
    <script>
      var lineDrawing = anime({
        targets: '#test',
        strokeDashoffset: [anime.setDashoffset, 0],
        easing: 'easeOutSine',
        opacity: 0,
        duration: 1500,
        direction: 'normal',
        autoplay: false,
        loop: true,
      });

      var path = anime.path('#test');

      // anime({
      //   targets: '#testRect',
      //   translateX: path('x'),
      //   translateY: path('y'),
      //   rotate: path('angle'),
      //   easing: 'easeOutSine',
      //   opacity: 0,
      //   duration: 1500,
      //   direction: 'normal',
      //   // autoplay: false,
      //   loop: true,
      // });

      // document.querySelector('#rainMode').onclick = lineDrawing.play;
    </script>
  </body>
</html>
