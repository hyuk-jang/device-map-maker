<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title></title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"
    />
    <link
      href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.7/dist/css/bootstrap-select.min.css"
    />
    <link rel="stylesheet" href="../css/template/common.css" />

    <script src="../js/jquery-3.4.1.min.js"></script>
    <script src="../js/panzoom.min.js"></script>

    <script src="../js/bootstrap.min.js"></script>
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.7/dist/js/bootstrap-select.min.js"></script>

    <script src="../js/svg.js"></script>
    <script src="../js/svg.filter.js"></script>

    <script src="../js/lodash.min.js"></script>

    <script src="../../out/defaultMap.js"></script>
    <script src="../js/drawSvg/drawSvg.js"></script>

  </head>

  <body>
    <!-- 메인 -->
    <!-- FIXME: 버튼 구조 수정 많이 필요  -->
    <div class="jumbotron text-center jumbotron_line">
      <div id="zoom" class="zoom_box">
        <button id="zoomIn" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon glyphicon-zoom-in"></span> 확대
        </button>
        <button id="zoomOut" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon glyphicon-zoom-out"></span> 축소
        </button>
        <button id="reset" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon glyphicon-refresh"></span> 초기화
        </button>
        <div class="mr_1rem">
          한/영
          <input id="placeNodeChangeNameToogleBtn" type="checkbox" data-toggle="toggle" />
        </div>
        <select class="selectpicker mr_1rem">
          <option value="view" selected>뷰 모드</option>
          <option value="control">제어 모드</option>
          <option value="develop">개발 모드</option>
        </select>
        <button id="rainMode" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon"></span> 우천모드
        </button>
        <button id="1" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon"></span> 저수지>증발지1
        </button>
        <button id="2" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon"></span> 증발지1>증발지2
        </button>
        <button id="3" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon"></span> 증발지2>해주
        </button>
        <button id="4" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon"></span> 해주>모듈
        </button>
        <button id="5" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon"></span> 모듈>결정지
        </button>
        </button>
        <button id="6" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon"></span> 결정지>해주2
        </button>
        <button id="animationReset" class="btn btn-default btn-sm mr_1rem">
          <span class="glyphicon"></span> 액션 리셋
        </button>
      </div>
      <div>
        <div id="canvas" style="justify-content:center;"></div>
      </div>
    </div>

    <script>
      // 실제 사용할 때는 해당 부분 수정
      map.drawInfo.frame.mapInfo.backgroundInfo.backgroundData = '../../out/defaultMap.png';
      // 멥 그리기
      drawSvgBasePlace('canvas');

      //모드 선택 설렉트 박스 and 한/영 토글 버튼
      $('select, #placeNodeChangeNameToogleBtn').change(() => {
        const selectedModeVal = $('select').selectpicker('val');
        const isChecked = $('#placeNodeChangeNameToogleBtn').prop('checked'); // 체크 상태 false: off, true: on

        $(`#canvas`).empty(); // svg가 그려진 공간 초기화

        drawSvgBasePlace('canvas', isChecked); // 초기화 후 다시 그리기 (체크 상태 포함)

        bindingClickEventNode('', selectedModeVal); // 장치, 센서 클릭 이벤트 다시 바인딩
      });
    </script>

    <!-- set panzoom -->
    <script>
      var canvas = document.getElementById('canvas');
      var canvasPanzoom = Panzoom(canvas, {
        cursor: 'default',
      });


      canvasPanzoom.pan(5, 100)
      $('#zoomIn').on('click', canvasPanzoom.zoomIn);
      $('#zoomOut').on('click', canvasPanzoom.zoomOut);
      $('#reset').on('click', canvasPanzoom.reset);
      canvas.addEventListener('wheel', canvasPanzoom.zoomWithWheel);
    </script>

    <!-- FIXME: map 그릴 때 좌표 찾기 용 -->
    <script>
      $('#svgCanvas').click(function(e) {
        var x = e.pageX;
        var y = e.pageY;

        console.log(x + ', ' + y);
      });
    </script>

    <!-- FIXME: 물결 세팅 노가다 *추후 삭제 또는 활용 -->  
    <script>
      var svgCanvas = SVG.get('#svgCanvas');

      // 저수지 물결
      var resorviorWave = svgCanvas
        .image('../../img/resorviorWave.gif')
        .move(1258, 30)
        .attr({ opacity: 0.2 });

      // 증발지 1 물결
      var normalEvaporationAWave = svgCanvas
        .image('../../img/normalEvaporationAWave.gif')
        .move(922, 26)
        .attr({ opacity: 0.2 });

      // 증발지2 물결
      var normalEvaporationBWave = svgCanvas
        .image('../../img/normalEvaporationBWave.gif')
        .move(762, 27)
        .attr({ opacity: 0.2 });

      // 해주1 물결
      var brineWarehouseAWave = svgCanvas
        .image('../../img/brineWarehouseAWave.gif')
        .move(605, 29)
        .attr({ opacity: 0.2 });

      // 모듈 물결
      var moduleWave = svgCanvas
        .image('../../img/moduleWave.gif')
        .move(228, 23)
        .backward()
        .attr({ opacity: 0.2 })

      // 해주2 물결
      var brineWarehouseBWave = svgCanvas
        .image('../../img/brineWarehouseBWave.gif')
        .move(81, 300)
        .attr({ opacity: 0.2 });

      // 레인 모드 폭포
      var rainModeWaterfull = svgCanvas
        .image('../../img/rainModeWaterfull.gif')
        .move(4, 10)
        .attr({ opacity: 0 });

      // 증발지1 폭포
      var normalEvaAwaterfull = svgCanvas
        .image('../../img/waterfallRight.gif')
        .move(1146, 30)
        .attr({ opacity: 0 });

      // 증발지2 폭포
      var normalEvaBWaterfull = svgCanvas
        .image('../../img/waterfallRight.gif')
        .move(836, 30)
        .attr({ opacity: 0 });

      // 해주1 폭포
      var brineWHAWaterfull = svgCanvas
        .image('../../img/brineWHAWaterfull.gif')
        .move(4, 10)
        .attr({ opacity: 0 });

      // 결정지 폭포
      var normalCrystalWaterfull = svgCanvas
        .image('../../img/waterfallRight.gif')
        .move(105, 30)
        .attr({ opacity: 0 });

      // 모듈 폭포
      var systemAWaterfull = svgCanvas
        .image('../../img/moduleWaterfull.gif')
        .move(500, 22)
        .attr({ opacity: 0 });
      var systemBWaterfull = svgCanvas
        .image('../../img/moduleWaterfull.gif')
        .move(500, 222)
        .attr({ opacity: 0 });
      var systemCWaterfull = svgCanvas
        .image('../../img/moduleWaterfull.gif')
        .move(500, 426)
        .attr({ opacity: 0 });
      var systemDWaterfull = svgCanvas
        .image('../../img/moduleWaterfull.gif')
        .move(500, 630)
        .attr({ opacity: 0 });

      // 해주2 폭포
      var brineWHBWaterfull = svgCanvas
        .image('../../img/waterfallRight.gif')
        .move(110, 350)
        .rotate(270)
        .scale(0.8)
        .attr({ opacity: 0 });

    </script>

    <!-- FIXME: 이벤트 노가다 *추후 삭제 또는 활용 -->  
    <script>
      //FIXME: reset  *추후 삭제 또는 활용
      function resetWave() {
        resorviorWave
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: 0.2 });

        normalEvaporationAWave
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: 0.2 });

        normalEvaporationBWave
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: 0.2 });

        brineWarehouseAWave
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: 0.2 });

        moduleWave
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: 0.2 });

        brineWarehouseBWave
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: 0.2 });

        rainModeWaterfull
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: 0 });

        normalEvaAwaterfull
          .animate({
            duraton: 1000,
            when: 'now',
          })
          .attr({ opacity: 0 });

        normalEvaBWaterfull
          .animate({
            duraton: 1000,
            when: 'now',
          })
          .attr({ opacity: 0 });

        brineWHAWaterfull
          .animate({
            duraton: 1000,
            when: 'now',
          })
          .attr({ opacity: 0 });

        normalCrystalWaterfull
          .animate({
            duraton: 1000,
            when: 'now',
          })
          .attr({ opacity: 0 });

        systemAWaterfull
          .animate({
            duraton: 1000,
            when: 'now',
          })
          .attr({ opacity: 0 });

        systemBWaterfull
          .animate({
            duraton: 1000,
            when: 'now',
          })
          .attr({ opacity: 0 });

        systemCWaterfull
          .animate({
            duraton: 1000,
            when: 'now',
          })
          .attr({ opacity: 0 });

        systemDWaterfull
          .animate({
            duraton: 1000,
            when: 'now',
          })
          .attr({ opacity: 0 });

        normalCrystalWaterfull
          .animate({
            duraton: 1000,
            when: 'now',
          })
          .attr({ opacity: 0 });

        brineWHBWaterfull
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({
            opacity: 0,
          });
      }

      // FIXME: rain mode  *추후 삭제 또는 활용
      function startRainMode(isTrue=true) {
        rainModeWaterfull
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 1 : 0 });

        brineWarehouseAWave
          .animate({
            duration: 6000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 0.5 : 0.2 });

        brineWarehouseBWave
          .animate({
            duration: 6000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 0.5 : 0.2 });

        normalEvaporationAWave
          .animate({
            duration: 9000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 0 : 0.2 });

        normalEvaporationBWave
          .animate({
            duration: 9000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 0 : 0.2 });

        moduleWave
          .animate({
            duration: 9000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 0 : 0.2 });
      }

      //FIXME: 저수지 > 증발지 1  *추후 삭제 또는 활용
      function flowToNormalEvaporationA(isTrue) {
        normalEvaAwaterfull
          .move(1146, 30)
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 1 :0 });

        normalEvaporationAWave
          .animate({
            duration: 9000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 0.4 : 0.2 });
      }

      //FIXME: 증발지1 > 증발지2  *추후 삭제 또는 활용
      function flowToNormalEvaporationB() {

        normalEvaBWaterfull
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 1 : 0 });

        normalEvaporationBWave
          .animate({
            duration: 9000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 0.4 : 0.2});
      }

      //FIXME: 증발지2 > 해주1  *추후 삭제 또는 활용
      function flowToBrineWarehouseA() {

        brineWHAWaterfull
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 1 : 0 });

        brineWarehouseAWave
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity:isTrue ? 0 : 0.2 });
      }

      //FIXME: 해주1 > 모듈  *추후 삭제 또는 활용
      function flowToModule() {

        systemAWaterfull
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 1 : 0 });

        systemBWaterfull
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 1 : 0 });

        systemCWaterfull
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 1 : 0 });

        systemDWaterfull
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 1 : 0 });

        moduleWave
          .animate({
            duration: 9000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 0.4 : 0.2 });
      }

      //FIXME: 모듈 > 결정지  *추후 삭제 또는 활용
      function flowToNormalCrystal() {

        normalCrystalWaterfull
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 1 : 0 });
      }

      //FIXME: 결정지 > 해주2  *추후 삭제 또는 활용
      function flowToBrineWarehouseB() {
        brineWHBWaterfull
          .animate({
            duration: 1000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 1 : 0 });

        brineWarehouseBWave
          .animate({
            duration: 9000,
            when: 'now',
          })
          .attr({ opacity: isTrue ? 0.4 : 0.2 });
      }
    </script>

    <!-- FIXME: 추 후 drawSvg로 이동해야할 소스 -->
    <script>

      var sensor =  svgCanvas.select('rect[name="sensor"]')
      var text =  svgCanvas.select('text[name="text"]')
      
      sensor.front();
      text.front();
    </script>

    <!-- FIXME: 애니메이션 효과 통합 func  *추후 삭제 또는 활용--> 
    <script>
      // 0(우천 시 염수 해주로 이동), stepNum 1 ~ 6 (수지에서 결정지까지 흐름), reset (default)
      function startFlowAnimation(stepNum, isTrue){
        switch (stepNum) {
          case 0:
            startRainMode(isTrue);
            break;
          case 1:
            flowToNormalEvaporationA(isTrue);
            break;
          case 2:
            flowToNormalEvaporationB(isTrue);
            break;
          case 3:
            flowToBrineWarehouseA(isTrue);
            break;
          case 4:
            flowToModule(isTrue);
            break;
          case 5:
            flowToNormalCrystal(isTrue);
            break;
          case 6:
            flowToBrineWarehouseB(isTrue);
            break;
          case 'reset':
            resetWave();
            break;
          default:
            break;
        }
      }
    
    </script>

    <!-- FIXME: 추 후 삭제 -->
    <script>
        //FIXME: button event  *추후 삭제 또는 활용
      $('#rainMode').on('click', function() {
        startFlowAnimation(0);
      });
      $('#1').on('click', function() {
         startFlowAnimation(1);
      });
      $('#2').on('click', function() {
         startFlowAnimation(2);
      });
      $('#3').on('click', function() {
         startFlowAnimation(3);
      });
      $('#4').on('click', function() {
         startFlowAnimation(4);
      });
      $('#5').on('click', function() {
         startFlowAnimation(5);
      });
      $('#6').on('click', function() {
         startFlowAnimation(6);
      });
      $('#animationReset').on('click', function() {
         startFlowAnimation('reset');
      });
    </script>
  </body>
</html>
